void bm_bezier3(Bitmap *b, int x0, int y0, int x1, int y1, int x2, int y2) {
    int lx = x0, ly = y0, steps;

    /* Compute how far the point x1,y1 deviates from the line from x0,y0 to x2,y2.
     * I make the number of steps proportional to that deviation, but it is not
     * a perfect system.
     */
    double dx = x2 - x0, dy = y2 - y0;
	
	assert(b);
    if(dx == 0 && dy == 0) {
      steps = 2;
    } else {
      /* https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line */
      double denom = sqrt(dx * dx + dy * dy);
      double dist = fabs((double)((y2 - y0) * x1 - (x2 - x0) * y1 + x2 * y0 + y2 * x0))/denom;
      steps = (int)sqrt(dist);
      if(steps == 0) steps = 1;
    }

    double inc = 1.0/steps;
    double t = inc;

    do {
        dx = (1-t)*(1-t)*x0 + 2*(1-t)*t*x1 + t*t*x2;
        dy = (1-t)*(1-t)*y0 + 2*(1-t)*t*y1 + t*t*y2;
        bm_line(b, lx, ly, (int)dx, (int)dy);
        lx = (int)dx;
        ly = (int)dy;
        t += inc;
    } while(t < 1.0);
    bm_line(b, lx, ly, x2, y2);
}
