static int ghash_update(struct shash_desc *desc,\n\r const u8 *src, unsigned int srclen)\n{\n\rstruct ghash_desc_ctx *dctx = shash_desc_ctx(desc);\n\rstruct ghash_ctx *ctx = crypto_shash_ctx(desc->tfm);\n\ru8 *dst = dctx->buffer;\n\n\rif (dctx->bytes) {\n\rint n = min(srclen, dctx->bytes);\n\ru8 *pos = dst + (GHASH_BLOCK_SIZE - dctx->bytes);\n\n\rdctx->bytes -= n;\n\rsrclen -= n;\n\n\rwhile (n--)\n\r*pos++ ^= *src++;\n\n\rif (!dctx->bytes)\n\rgf128mul_4k_lle((be128 *)dst, ctx->gf128);\n\r}\n\n\rwhile (srclen >= GHASH_BLOCK_SIZE) {\n\rcrypto_xor(dst, src, GHASH_BLOCK_SIZE);\n\rgf128mul_4k_lle((be128 *)dst, ctx->gf128);\n\rsrc += GHASH_BLOCK_SIZE;\n\rsrclen -= GHASH_BLOCK_SIZE;\n\r}\n\n\rif (srclen) {\n\rdctx->bytes = GHASH_BLOCK_SIZE - srclen;\n\rwhile (srclen--)\n\r*dst++ ^= *src++;\n\r}\n\n\rreturn 0;\n}
